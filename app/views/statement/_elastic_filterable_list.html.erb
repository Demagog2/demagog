<% 
statement_elastic_filterable_list_presenter = StatementElasticFilterableListPresenter.new(
  context: context,
  enable_filters: enable_filters,
  params: params
)
show_speaker_role = true if local_assigns[:show_speaker_role].nil?
show_medium_and_date = true if local_assigns[:show_medium_and_date].nil?
wide_display = true if local_assigns[:wide_display].nil?
%>


<% if statement_elastic_filterable_list_presenter.unfiltered_total > 0 %>
  <div
    class="container-statement-elastic-filterable-list"
    data-controller="statement--elastic-filterable-list"
    data-statement--elastic-filterable-list-no-filters-url="<%= no_filters_url %>"
  >
    <h2>
      <%= statement_elastic_filterable_list_presenter.unfiltered_total %>
      <%= cs_pluralize(statement_elastic_filterable_list_presenter.unfiltered_total, "výrok", "výroky", "výroků") %>
    </h2>

    <% if false # TODO: remove when infoboxes texts are ready %>
    <div class="infoboxes-list">
      <div class="infobox-item">
        <%= render(partial: "shared/infobox", locals: { topic: :choosing_statements, id: "statement-filterable-list-choosing-statements" }) %>
      </div>
      <% if statements.any? { |s| s.important } %>
        <div class="infobox-item">
          <%= render(partial: "shared/infobox", locals: { topic: :editor_picked_statements, id: "statement-filterable-list-editor-picked-statement" }) %>
        </div>
      <% end %>
    </div>
    <% end %>

    <div class="filters-header">Filtry</div>

    <form class="filters-list" data-target="statement--elastic-filterable-list.filtersForm" data-action="submit->statement--elastic-filterable-list#onFiltersListSubmit">
      <% if enable_filters.include?(:tag_id) && statement_elastic_filterable_list_presenter.filter_options[:tag_id].size > 0 %>
        <div class="filter-item">
          <select name="tema" data-action="change->statement--elastic-filterable-list#onFilterSelectChange" class="filter-select">
            <option value="">Všechna témata</option>
            <% statement_elastic_filterable_list_presenter.filter_options[:tag_id].each do |filter_option| %>
              <option value="<%= filter_option[:value] %>" <% if filter_option[:selected] %>selected<% end %>>
                <%= filter_option[:label] %> (<%= filter_option[:count] %> <%= cs_pluralize(filter_option[:count], "výrok", "výroky", "výroků") %>)
              </option>
            <% end %>
          </select>
        </div>
      <% end %>

      <% if enable_filters.include?(:veracity_key) %>
        <div class="filter-item">
          <select name="hodnoceni" data-action="change->statement--elastic-filterable-list#onFilterSelectChange" class="filter-select">
            <option value="">Všechna hodnocení</option>
            <% statement_elastic_filterable_list_presenter.filter_options[:veracity_key].each do |filter_option| %>
              <option
                <% if filter_option[:count] == 0 %>disabled<% end %>
                <% if filter_option[:selected] %>selected<% end %>
                value="<%= filter_option[:value] %>"
              >
                <%= filter_option[:label] %> (<%= filter_option[:count] %> <%= cs_pluralize(filter_option[:count], "výrok", "výroky", "výroků") %>)
              </option>
            <% end %>
          </select>
        </div>
      <% end %>

      <% if enable_filters.include?(:released_year) && statement_elastic_filterable_list_presenter.filter_options[:released_year].size > 0 %>
        <div class="filter-item">
          <select name="rok" data-action="change->statement--elastic-filterable-list#onFilterSelectChange" class="filter-select">
            <option value="">Všechny roky</option>
            <% statement_elastic_filterable_list_presenter.filter_options[:released_year].each do |filter_option| %>
              <option
                <% if filter_option[:count] == 0 %>disabled<% end %>
                <% if filter_option[:selected] %>selected<% end %>
                value="<%= filter_option[:value] %>"
              >
                <%= filter_option[:label] %> (<%= filter_option[:count] %> <%= cs_pluralize(filter_option[:count], "výrok", "výroky", "výroků") %>)
              </option>
            <% end %>
          </select>
        </div>
      <% end %>

      <% if enable_filters.include?(:fulltext) %>
        <div class="filter-item">
          <div class="filter-fulltext">
            <input type="text" name="q" value="<%= statement_elastic_filterable_list_presenter.parsed_params_filters[:query] %>" placeholder="Zadejte hledaný výraz…">
            <button type="submit" data-action="click->statement--elastic-filterable-list#onFulltextConfirmButton">
              <svg height="17" viewBox="0 0 17 17" width="17" xmlns="http://www.w3.org/2000/svg">
                <path d="m1181.34341 104.52344-4.0019-4.018708c1.69829-2.5558307 1.36199-5.9523952-.8071-8.1214883-1.22747-1.2106567-2.84168-1.8832437-4.57359-1.8832437s-3.34612.672587-4.55678 1.8832437c-2.50539 2.5222013-2.50539 6.6081675 0 9.1135543 2.16909 2.169093 5.56566 2.505387 8.12149.823919l4.01871 4.018707c.18496.184962.50444.184962.6894 0l1.10977-1.109768c.20177-.201776.20177-.521255 0-.706216zm-6.28869-4.489519c-1.69828 1.698282-4.47271 1.698282-6.1878 0-1.69829-1.6982821-1.69829-4.4727036 0-6.1878005 1.69828-1.6982823 4.4727-1.6982823 6.1878 0 1.69828 1.7150969 1.69828 4.4895184 0 6.1878005z" fill="#3c325c" transform="translate(-1165 -90)"/>
              </svg>
            </button>
          </div>
        </div>      
      <% end %>

      <% if enable_filters.include?(:editor_picked) %>
        <div class="filter-item">
          <div class="filter-checkbox">
            <input
              type="checkbox"
              name="vyber"
              value="ano"
              id="statement-elastic-filterable-list-editor-picked-checkbox"
              data-action="change->statement--elastic-filterable-list#onFilterCheckboxChange"
              <% if statement_elastic_filterable_list_presenter.filter_options[:editor_picked][:selected] %>checked<% end %>
              <% if statement_elastic_filterable_list_presenter.filter_options[:editor_picked][:count] == 0 %>disabled<% end %>
            >
            <label for="statement-elastic-filterable-list-editor-picked-checkbox">
              <%= statement_elastic_filterable_list_presenter.filter_options[:editor_picked][:label] %>
              (<%= statement_elastic_filterable_list_presenter.filter_options[:editor_picked][:count] %> <%= cs_pluralize(statement_elastic_filterable_list_presenter.filter_options[:editor_picked][:count], "výrok", "výroky", "výroků") %>)
            </label>
          </div>
        </div>
      <% end %>
    </form>

    <div class="filtered-count-info<% if statement_elastic_filterable_list_presenter.parsed_params_filters.empty? %> hidden<% end %>">
      <span class="filtered-count-info-label">
        <% if statement_elastic_filterable_list_presenter.filtered_total > 0 %>
          Vybraným filtrům <%= cs_pluralize(statement_elastic_filterable_list_presenter.filtered_total, "vyhovuje", "vyhovují", "vyhovuje") %>
          <%= statement_elastic_filterable_list_presenter.filtered_total %>
          <%= cs_pluralize(statement_elastic_filterable_list_presenter.filtered_total, "výrok", "výroky", "výroků") %>
        <% end %>
        <% if statement_elastic_filterable_list_presenter.filtered_total == 0 %>
          Vybraným filtrům nevyhovuje ani jeden výrok
        <% end %>
      </span>
      <a
        href="<%= no_filters_url %>"
        class="clear-filters"
      >
        × zrušit filtry
      </a>
    </div>

    <div class="statement-filterable-list-statements">
      <% statement_elastic_filterable_list_presenter.paginated_statements.each do |statement| %>
        <div
          class="statement-filterable-list-statement-item"
          id="vyrok-<%= statement.id %>"
          data-target="statement--filterable-list.statement"
          data-speaker-id="<%= "#{statement.speaker.full_name.parameterize}-#{statement.speaker.id.to_s}" %>"
          data-tag-ids="<%= statement.tags.map { |tag| "#{tag.name.parameterize}-#{tag.id}" }.join('||') %>"
          data-veracity-key="<%= statement.assessment.veracity.key %>"
        >
          <%=
            render(
              partial: "statement/detail",
              object: statement,
              as: :statement,
              locals: { show_speaker_role: show_speaker_role, show_medium_and_date: show_medium_and_date, wide_display: wide_display }
            )
          %>
        </div>
      <% end %>
    </div>

    <%= paginate(statement_elastic_filterable_list_presenter.paginated_statements) %>
  </div>
<% end %>  
